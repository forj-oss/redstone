#
# (c) Copyright 2014 Hewlett-Packard Development Company, L.P.
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#
# hieradata automatically generated by 'a script python to create'.py
#
#
#
# PYTHON comment: classes is a data retrieved from the 'openstack-layout.yaml'
# PYTHON comment: It uses name and list of application (attaching a class name for each application, determined from the openstack-master.yaml)
classes:
  - maestro::node_vhost_lookup
  - maestro::backup::configure_box
  - maestro::backup::manage_backup
  - cdk_project::pip
  - cdk_project::gerrit
  - maestro::app::tool_status
  - sysadmin_config::manage_servers

# use pind version for jeepyb on all servers
jeepyb_config::jeepyb_version: '3c9a851fa93518bde584a75f6dd715b54f878e72'

# Gerrit tool
cdk_project::gerrit::vhost_name:                       "%{::maestro::node_vhost_lookup::vname}" #$gerrit_vhost
cdk_project::gerrit::ip_vhost_name:                    "%{::maestro::node_vhost_lookup::vname}" #$gerrit_server
cdk_project::gerrit::canonicalweburl:                  "https://%{::maestro::node_vhost_lookup::vname}/" #$gerrit_server_url
cdk_project::gerrit::serveradmin:                      "webmaster@%{::domain}"
cdk_project::gerrit::ssh_host_key:                     '/home/gerrit2/review_site/etc/ssh_host_rsa_key'
cdk_project::gerrit::ssh_project_key:                  '/home/gerrit2/review_site/etc/ssh_project_rsa_key'
cdk_project::gerrit::ssl_cert_file:                    "/etc/ssl/certs/%{::fqdn}.pem"
cdk_project::gerrit::ssl_key_file:                     "/etc/ssl/private/%{::fqdn}.key"
cdk_project::gerrit::ssl_chain_file:                   '/etc/ssl/certs/intermediate.pem'
# these will be automatically created if we pass them in empty.
cdk_project::gerrit::ssl_cert_file_contents:           ''
cdk_project::gerrit::ssl_key_file_contents:            ''
cdk_project::gerrit::ssl_chain_file_contents:          ''
# Working with a test server, generate some keys
cdk_project::gerrit::ssh_dsa_key_contents:             ''
cdk_project::gerrit::ssh_dsa_pubkey_contents:          ''
cdk_project::gerrit::ssh_rsa_key_contents:             ''
cdk_project::gerrit::ssh_rsa_pubkey_contents:          ''
cdk_project::gerrit::ssh_project_rsa_key_contents:     ''
cdk_project::gerrit::ssh_project_rsa_pubkey_contents:  ''

cdk_project::gerrit::email:                            "review@%{::domain}"
# 1 + 100 + 9 + 2 + 2 + 25 = 139(rounded up)
cdk_project::gerrit::database_poollimit:               '150'
cdk_project::gerrit::container_heaplimit:              ''
cdk_project::gerrit::core_packedgitopenfiles:          '4096'
cdk_project::gerrit::core_packedgitlimit:              '400m'
cdk_project::gerrit::core_packedgitwindowsize:         '16k'
cdk_project::gerrit::sshd_threads:                     '100'
cdk_project::gerrit::httpd_acceptorthreads:            ''
cdk_project::gerrit::httpd_minthreads:                 ''
cdk_project::gerrit::httpd_maxthreads:                 ''
cdk_project::gerrit::httpd_maxwait:                    '5000min'
cdk_project::gerrit::war:                              'http://tarballs.openstack.org/ci/gerrit-2.4.4-14-gab7f4c1.war'
cdk_project::gerrit::contactstore:                     false
cdk_project::gerrit::contactstore_appsec:              ''
cdk_project::gerrit::contactstore_pubkey:              ''
cdk_project::gerrit::contactstore_url:                 'http://www.openstack.org/verify/member/'
cdk_project::gerrit::script_user:                      'gerrit2'
cdk_project::gerrit::script_key_file:                  '/home/gerrit2/.ssh/gerrit2'
cdk_project::gerrit::script_logging_conf:              '/home/gerrit2/.sync_logging.conf'
cdk_project::gerrit::projects_file:                    'review.projects.yaml.erb'
cdk_project::gerrit::github_username:                  ''  # "%{::domain}-gerrit"
cdk_project::gerrit::github_oauth_token:               ''
cdk_project::gerrit::github_project_username:          ''
cdk_project::gerrit::github_project_password:          ''
cdk_project::gerrit::mysql_password:                   'changeme'
cdk_project::gerrit::mysql_root_password:              'changeme'
cdk_project::gerrit::trivial_rebase_role_id:           "trivial-rebase@review.%{::domain}"
#TODO needs autogeneration at some point
cdk_project::gerrit::email_private_key:                'FU7D198KY5xEx55/+YA1piHcfhwy/fo8sZk='
cdk_project::gerrit::local_git_dir:                    '/var/lib/git'
cdk_project::gerrit::cla_description:                  'OpenStack ICLA'
cdk_project::gerrit::cla_file:                         'static/cla.html'
cdk_project::gerrit::cla_id:                           '2'
cdk_project::gerrit::cla_name:                         'ICLA'
cdk_project::gerrit::testmode:                         false
cdk_project::gerrit::sysadmins:                        ''
cdk_project::gerrit::swift_username:                   ''
cdk_project::gerrit::swift_password:                   ''
cdk_project::gerrit::ca_certs_db:                      '/opt/config/cacerts'
cdk_project::gerrit::runtime_module:                   'runtime_project'
cdk_project::gerrit::environment:                      ''
cdk_project::gerrit::override_vhost:                   true
cdk_project::gerrit::demo_enabled:                     true
cdk_project::gerrit::buglinks_enabled:                 true
cdk_project::gerrit::replicate_local:                  ''
cdk_project::gerrit::replication:                      ''
cdk_project::gerrit::openidssourl:                     'https://login.launchpad.net/+openid'
cdk_project::gerrit::require_contact_information:      'N'

# backup tool
maestro::backup::set_app_backup:
  gerrit: 
    app_location:     '/home/gerrit2'
    db_name:          'reviewdb'
    db_backup_tool:   'mysqldump'
    db_user:          'gerrit2'
    db_password:      'changeme'

# setup server (iptables, rsyslog, tcpdump, ssh)
sysadmin_config::manage_servers::iptables_public_tcp_ports:
  - 80
  - 443
  - 8080
  - 8139
  - 8140
  - 29418

# Tool status
maestro::tool_status::source: 'puppet:///modules/runtime_project/tool_status/review/toolstatus.sh'